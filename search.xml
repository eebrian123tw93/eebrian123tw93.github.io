<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>DMA (Direct Memory Access)</title>
    <url>/2023/11/18/DMA%20(Direct%20Memory%20Access)/</url>
    <content><![CDATA[<h1 id="介紹"><a href="#介紹" class="headerlink" title="介紹"></a>介紹</h1><p><img src="/images/20231119023846.png"><br>直接記憶體存取（Direct Memory Access，DMA） 獨立地直接讀寫系統記憶體，而不需中央處理器介入處理，減輕處理器負擔，減輕內核工作量</p>
<p>簡單來說，就是搬資料，不需要用到CPU的指令。換言之，搬資料時，CPU不用知道。要怎麼做可以確保搬的資料不會錯。</p>
<ol>
<li>要知道原始資料的位置。</li>
<li>要知道目地的位置。</li>
<li>要知道要搬多少資料長度。</li>
</ol>
<h1 id="配置DMA-以SRAM到外部設備"><a href="#配置DMA-以SRAM到外部設備" class="headerlink" title="配置DMA(以SRAM到外部設備)"></a>配置DMA(以SRAM到外部設備)</h1><ul>
<li>從哪裡複製(要複製的地址) SRAM Address</li>
<li>複製的地址(複製目的地的地址) 外部設備 Address</li>
<li>DMA方向 從 SRAM 到 外部設備</li>
<li>傳輸資料大小</li>
<li>SRAM 地址自增 On or Off </li>
<li>外部設備 地址自增  On or Off</li>
</ul>
<h1 id="參考影片"><a href="#參考影片" class="headerlink" title="參考影片"></a>參考影片</h1><ul>
<li><a href="https://www.youtube.com/watch?v=2_X9qD12_pw">10行代码，就能让你真正理解DMA！你用的可能很少，但是在单片机中非常重要！</a></li>
</ul>
<h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul>
<li><a href="https://sharing-icdesign-experience.blogspot.com/2014/05/dma.html">什麼是DMA ?</a></li>
<li><a href="https://blog.csdn.net/as480133937/article/details/104927922">【STM32】 DMA原理，步骤超细详解，一文看懂DMA</a></li>
</ul>
]]></content>
      <tags>
        <tag>DMA</tag>
      </tags>
  </entry>
  <entry>
    <title>H264基礎知識</title>
    <url>/2024/01/16/H264%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98/</url>
    <content><![CDATA[<h1 id="H264"><a href="#H264" class="headerlink" title="H264"></a>H264</h1><p>MPEG-4的⼀個組成部分–MPEG-4 Part 10，⼜叫Advanced Video Codec，因此常稱為MPEG-4 AVC或直接叫AVC</p>
<h1 id="I幀-B幀-P幀-IDR幀"><a href="#I幀-B幀-P幀-IDR幀" class="headerlink" title="I幀, B幀,P幀,IDR幀"></a>I幀, B幀,P幀,IDR幀</h1><p><img src="/images/20240116150548.png"></p>
<h2 id="I幀-關鍵幀"><a href="#I幀-關鍵幀" class="headerlink" title="I幀 關鍵幀"></a>I幀 關鍵幀</h2><h2 id="P幀-前向預測編碼幀"><a href="#P幀-前向預測編碼幀" class="headerlink" title="P幀 前向預測編碼幀"></a>P幀 前向預測編碼幀</h2><h2 id="B幀-雙向預測內插編碼幀"><a href="#B幀-雙向預測內插編碼幀" class="headerlink" title="B幀 雙向預測內插編碼幀"></a>B幀 雙向預測內插編碼幀</h2><h2 id="IDR幀-I-幀的一種-立即刷新"><a href="#IDR幀-I-幀的一種-立即刷新" class="headerlink" title="IDR幀  I 幀的一種 立即刷新"></a>IDR幀  I 幀的一種 立即刷新</h2><p>IDR 幀禁止後面的幀向自己前面的幀參照</p>
<h2 id="GOP-兩個I幀之間的間隔"><a href="#GOP-兩個I幀之間的間隔" class="headerlink" title="GOP 兩個I幀之間的間隔"></a>GOP 兩個I幀之間的間隔</h2><p>完整編碼的幀叫 I幀，參考先前的 I 幀產生的只包含差異部分編碼的幀叫 P幀，還有一種參考前後的幀編碼的幀叫 B幀<br>H264採用的核心演算法是幀內壓縮和幀間壓縮，幀內壓縮是產生 I 幀的演算法，幀間壓縮是產生 B 幀和 P 幀的演算法</p>
<p>壓縮率 B幀 &gt; P幀 &gt; I幀<br>訊息量 I幀 &gt; P幀 &gt; B幀</p>
<p>幀特性看底下連結<br><a href="https://blog.csdn.net/qq_29350001/article/details/73770702">图像和流媒体 – I 帧,B帧,P帧,IDR帧的区别</a></p>
<h1 id="NALU-Network-Abstract-Layer-Unit"><a href="#NALU-Network-Abstract-Layer-Unit" class="headerlink" title="NALU (Network Abstract Layer Unit)"></a>NALU (Network Abstract Layer Unit)</h1><p><u><strong>H264編碼資料儲存或傳輸的基本單元</strong></u><br> 一般來說 前兩個是 SPS PPS 再來是IDR幀 再來是 P幀或B幀</p>
<ul>
<li>SPS(Sequence Parameter Sets)：序列參數集，保存了一組編碼視訊序列(Coded video sequence)的全域參數。 </li>
<li>PPS(Picture Parameter Set)：影像參數集，對應的是一個序列中某一副影像或某幾副影像的參數。 </li>
<li>SEI(Supplemental enhancement information)：附加增強訊息，包含了視訊畫面定時等信息，一般放在主編碼影像資料之前，在某些應用中，它可以被省略掉。</li>
<li>IDR(Instantaneous Decoding Refresh)：即時解碼刷新。</li>
<li>HRD(Hypothetical Reference Decoder)：假想碼流調度器<br> 。<br>如何拆解H264數據流中的NALU<br>每個NALU中，是以0x00000001 或 0x000001 當作開始標記，開始標記的後面一個字節 和 0x1f 做 &amp; 的運算得出 NALU 類型<br><img src="/images/20240116154054.png"><br>舉例: 上面有4個NALU 開頭都為 0x000001 後面一格字節就是算出NALU類型的因子<br>NALU(nal_unit_type) 類型 推導</li>
<li>0x06 &amp; 0x1f &#x3D; 6 (SEI)</li>
<li>0x67 &amp; 0x1f &#x3D; 7 (SPS)</li>
<li>0x68 &amp; 0x1f &#x3D; 8 (PPS)</li>
<li>0x65 &amp; 0x1f &#x3D; 5 (IDR)<br><img src="/images/20240116154827.png"></li>
<li><a href="https://zhuanlan.zhihu.com/p/409527359">H264之NALU解析</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/71928833">视频和视频帧：H264编码格式整理</a></li>
</ul>
<h1 id="H264有兩種封裝"><a href="#H264有兩種封裝" class="headerlink" title="H264有兩種封裝"></a>H264有兩種封裝</h1><ul>
<li><h4 id="AnnexB格式"><a href="#AnnexB格式" class="headerlink" title="AnnexB格式"></a>AnnexB格式</h4>  这种格式比较常见，也就是我们熟悉的每个帧前面都有<code>0x00 00 00 01</code>或者<code>0x00 00 01</code>作为起始码。<br>  h264文件就是采用的这种格式，每个帧前面都要有个起始码。<br>  SPS PPS等也作为一类NALU存储在这个码流中，一般在码流最前面。也就是说这种格式包含VCL 和 非VCL 类型的NALU。 </li>
<li><strong>AVCC格式</strong><br>  这种模式也叫AVC1格式，没有起始码，每个帧最前面几个字节（通常4字节）是帧长度。<br>  这里的NALU一般没有SPS PPS等参数信息，参数信息属于额外数据extradata存在其他地方。<br>  比如ffmpeg中解析mp4文件后sps pps存在streams[index]-&gt;codecpar-&gt;extradata;中。<br>  也就是说这种码流通常只包含VCL类型NALU。<br>  这些extradata通常有如下格式（可以根据这个规则ffmpeg解析mp4文件的SPS和PPS）</li>
</ul>
<h1 id="H264-编码-—profile-和-level"><a href="#H264-编码-—profile-和-level" class="headerlink" title="# H264 编码 —profile 和 level"></a># H264 编码 —profile 和 level</h1><ul>
<li>baseline profile：基本画质。支持 I&#x2F;P 帧，只支持无交错（Progressive）和 CAVLC</li>
<li>extended profile：进阶画质。支持 I&#x2F;P&#x2F;B&#x2F;SP&#x2F;SI 帧，只支持无交错（Progressive）和 CAVLC；(用的少)</li>
<li>main profile：主流画质。提供 I&#x2F;P&#x2F;B 帧，支持无交错（Progressive）和交错（Interlaced），也支持 CAVLC 和 CABAC 的支持</li>
<li>high profile：高级画质。在 main profile 的基础上增加了 8x8 内部预测、自定义量化、无损视频编码和更多的 YUV 格式<br><a href="https://winddoing.github.io/post/e114a1a8.html">H264 编码 —profile 和 level</a></li>
</ul>
]]></content>
      <tags>
        <tag>H264</tag>
        <tag>I幀</tag>
        <tag>GOP</tag>
        <tag>P幀</tag>
        <tag>IDR幀</tag>
        <tag>B幀</tag>
        <tag>NALU</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World 使用Github pages 靜態網站</title>
    <url>/2023/05/05/Hello%20World%20%E4%BD%BF%E7%94%A8Github%20pages%20%E9%9D%9C%E6%85%8B%E7%B6%B2%E7%AB%99/</url>
    <content><![CDATA[<p>建立一個新的倉庫 命名為 <strong>帳戶名稱.github.io</strong><br><img src="/images/image.png" alt="建立一個新的倉庫"></p>
<p>好了之後在自己的電腦上clone專案下來</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone git@github.com:eebrian123tw60/eebrian123tw60.github.io.git</span><br></pre></td></tr></table></figure>
<p>進入專案 新增一個index.html 內容是Hello World</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd eebrian123tw60.github.io</span><br><span class="line">echo &quot;Hello World&quot; &gt; index.html</span><br></pre></td></tr></table></figure>
<p>推到遠端的倉庫</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git add --all</span><br><span class="line">git commit -m &quot;Initial commit&quot;</span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure>
<p>等待幾分鐘 訪問<a href="https://eebrian123tw60.github.io/">https://eebrian123tw60.github.io/</a><br><img src="/images/image2.png"><br>結果就出來拉！！</p>
<hr>
<h2 id="參考連結"><a href="#參考連結" class="headerlink" title="參考連結"></a>參考連結</h2><ul>
<li><a href="https://pages.github.com/">https://pages.github.com/</a></li>
<li><a href="https://medium.com/%E9%80%B2%E6%93%8A%E7%9A%84-git-git-git/%E5%BE%9E%E9%9B%B6%E9%96%8B%E5%A7%8B-%E7%94%A8github-pages-%E4%B8%8A%E5%82%B3%E9%9D%9C%E6%85%8B%E7%B6%B2%E7%AB%99-fa2ae83e6276">從零開始: 用github pages 上傳靜態網站</a></li>
</ul>
]]></content>
      <tags>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title>PWM(Pulse-width modulation)</title>
    <url>/2023/11/18/PWM(Pulse-width%20modulation)/</url>
    <content><![CDATA[<h1 id="介紹"><a href="#介紹" class="headerlink" title="介紹"></a>介紹</h1><p><img src="/images/20231119023727.png"><br>是將脈波轉為類比信號的“一種技術”,利用在頻率不變的狀態下, 改變占空比大小, 使整體平均電壓值上升或下降, 藉此間歇性電壓及功率切換以節省能源及控制等效果.</p>
<h1 id="Period-週期"><a href="#Period-週期" class="headerlink" title="Period 週期"></a>Period 週期</h1><p>通常週期固定然後調整占空比</p>
<h1 id="Duty-Circle-占空比"><a href="#Duty-Circle-占空比" class="headerlink" title="Duty Circle(占空比)"></a>Duty Circle(占空比)</h1><p>100%代表有1個clock有百分之100是高電平 平均電壓為 5V<em>1 &#x3D; 5V<br>75%代表有1個clock有百分之75是高電平 平均電壓為 5V</em>0.75 &#x3D; 3.75V<br>25%代表有1個clock有百分之25是高電平 平均電壓為 3V<em>0.25 &#x3D; 2.25V<br>0%代表有1個clock有百分之0是高電平 平均電壓為 3V</em>0 &#x3D; 0V<br>藉由控制占空比可以控制平均電壓 控制功率 可以控制燈的亮度 馬達轉速</p>
<h1 id="範例-WS2812B"><a href="#範例-WS2812B" class="headerlink" title="範例 WS2812B"></a>範例 WS2812B</h1><h2 id="WS2812B-PWM-如果是單純用PWM用IO的方法控制duty-cycle無法控制到每個bit"><a href="#WS2812B-PWM-如果是單純用PWM用IO的方法控制duty-cycle無法控制到每個bit" class="headerlink" title="WS2812B PWM 如果是單純用PWM用IO的方法控制duty_cycle無法控制到每個bit"></a>WS2812B PWM 如果是單純用PWM用IO的方法控制duty_cycle無法控制到每個bit</h2><p>period &#x3D; 800Khz 1&#x2F;800000 &#x3D; 1250 ns<br>duty cycle 33% <code>1250*0.333 = 412.5</code> 0 碼<br>duty cycle 67% <code>1250*0.666 = 825</code> 1 碼<br>ws2812 复位信号为一个 不低于 50us</p>
<h3 id="注册该pwm通道"><a href="#注册该pwm通道" class="headerlink" title="注册该pwm通道"></a>注册该pwm通道</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /sys/class/pwm/pwmchip0/npwm</span><br><span class="line">echo 0 &gt; /sys/class/pwm/pwmchip0/export</span><br></pre></td></tr></table></figure>
<h3 id="設定週期-ns"><a href="#設定週期-ns" class="headerlink" title="設定週期(ns)"></a>設定週期(ns)</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo 1250 &gt; /sys/class/pwm/pwmchip0/pwm0/period</span><br></pre></td></tr></table></figure>
<h3 id="設定duty-cycle-ns"><a href="#設定duty-cycle-ns" class="headerlink" title="設定duty cycle(ns)"></a>設定duty cycle(ns)</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo 825 &gt; /sys/class/pwm/pwmchip0/pwm0/duty_cycle</span><br></pre></td></tr></table></figure>

<h3 id="開燈"><a href="#開燈" class="headerlink" title="開燈"></a>開燈</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo 825 &gt; /sys/class/pwm/pwmchip0/pwm0/duty_cycle</span><br><span class="line">echo 1 &gt; /sys/class/pwm/pwmchip0/pwm0/enable</span><br><span class="line">echo 0 &gt; /sys/class/pwm/pwmchip0/pwm0/enable</span><br></pre></td></tr></table></figure>
<h3 id="關燈"><a href="#關燈" class="headerlink" title="關燈"></a>關燈</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo 412 &gt; /sys/class/pwm/pwmchip0/pwm0/duty_cycle</span><br><span class="line">echo 1 &gt; /sys/class/pwm/pwmchip0/pwm0/enable</span><br><span class="line">echo 0 &gt; /sys/class/pwm/pwmchip0/pwm0/enable</span><br></pre></td></tr></table></figure>



<h1 id="參考影片"><a href="#參考影片" class="headerlink" title="參考影片"></a>參考影片</h1><ul>
<li><a href="https://www.youtube.com/watch?v=LCejYewAgwA">2.1.1脈衝寬度(PWM)基本介紹</a></li>
<li><a href="https://www.youtube.com/watch?v=27GkMk8ct0s">[Arduino 教學課程] 什麼！用pwm就能控制LED亮度？那個像是蚯蚓符號的東西原來有其他用意？來實作看看呼吸燈ㄅ 從零開始學Arduino #11</a></li>
</ul>
]]></content>
      <tags>
        <tag>PWM</tag>
        <tag>WS2812B</tag>
      </tags>
  </entry>
  <entry>
    <title>VM安裝</title>
    <url>/2023/11/29/VM%E5%AE%89%E8%A3%9D/</url>
    <content><![CDATA[<h2 id="Install-Guest-Additions"><a href="#Install-Guest-Additions" class="headerlink" title="Install Guest Additions"></a>Install Guest Additions</h2><p><code>sudo apt-get install gcc make perl -y</code><br><img src="/images/20231129152725.png"><br>插入 Guest Additions CD 映像<br><img src="/images/20231129152840.png"><br>點擊Run<br><img src="/images/20231129152907.png"><br>輸入密碼<br><img src="/images/20231129152934.png"><br>運行中<br><img src="/images/20231129153043.png"><br>無報錯 安裝成功後 reboot 可以縮放 剪貼簿 公用資料夾</p>
<h3 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h3><ul>
<li><a href="https://blog.csdn.net/bell_love/article/details/105401852">简单解决Please install the gcc make perl packages from your distribution问题</a></li>
</ul>
<h2 id="共用資料夾"><a href="#共用資料夾" class="headerlink" title="共用資料夾"></a>共用資料夾</h2><p><img src="/images/20231129154247.png"><br>點擊共用資料夾設定<br><img src="/images/20231129154432.png"><br>點擊加號<br><img src="/images/20231129154530.png"><br>輸入要掛載的資料夾 和 掛載點 點擊確認<br><img src="/images/20231129154609.png"><br>成功會出現在掛載點</p>
<h3 id="參考-1"><a href="#參考-1" class="headerlink" title="參考"></a>參考</h3><ul>
<li><a href="https://www.jinnsblog.com/2021/05/virtualbox-shared-folder-permission-setting.html">[Linux &#x2F; Windows] VirtualBox 共用資料夾與雙向剪貼簿之權限設定</a></li>
</ul>
<h2 id="加入憑證"><a href="#加入憑證" class="headerlink" title="加入憑證"></a>加入憑證</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> my-ca-certificate.crt /usr/local/share/ca-certificates/</span><br><span class="line"><span class="built_in">cd</span> /usr/local/share/ca-certificates/</span><br><span class="line">sudo <span class="built_in">chmod</span> 644 my-ca-certificate.crt</span><br><span class="line">sudo  update-ca-certificates</span><br></pre></td></tr></table></figure>
<h3 id="參考-2"><a href="#參考-2" class="headerlink" title="參考"></a>參考</h3><ul>
<li><a href="https://blog.kkbruce.net/2020/01/linux-windows-container-add-cert.html">如何為LINUX, WINDOWS容器加入憑證?</a></li>
</ul>
<h2 id="Samba"><a href="#Samba" class="headerlink" title="Samba"></a>Samba</h2><p><img src="/images/20231129163310.png"><br>新增網路介面卡2 僅限主機 介面卡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt-get install samba -y</span><br><span class="line">smbpasswd -a root #設定root 密碼</span><br><span class="line">vim /etc/samba/smb.conf </span><br></pre></td></tr></table></figure>
<p>smb.conf 加入底下的設定 使用root 登入 &#x2F;media&#x2F;new_drive 需要存在</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[brian]</span><br><span class="line">   comment = new_drive</span><br><span class="line">   public = yes</span><br><span class="line">   path = /media/new_drive</span><br><span class="line">   guest ok = yes</span><br><span class="line">   read only = no</span><br><span class="line">   browseable = yes</span><br><span class="line">   create mask = 777</span><br><span class="line">   directory mask = 777</span><br><span class="line">   writable = yes</span><br><span class="line">   valid users = root</span><br></pre></td></tr></table></figure>
<p><img src="/images/20231129160349.png"><br><code>samba restart</code> or <code>/etc/init.d/smbd restart</code><br><img src="/images/20231129160659.png"><br>本機右鍵 連線網路磁碟機<br><img src="/images/20231129160740.png"><br>輸入上面資訊 <code>\\192.168.56.108\brian</code> brian 為設定檔<code>[brian]</code><br>之後 按完成 需要輸入密碼 </p>
<h3 id="參考-3"><a href="#參考-3" class="headerlink" title="參考"></a>參考</h3><ul>
<li><a href="https://hollyqood.wordpress.com/2016/12/08/virtualbox%e8%99%9b%e6%93%ac%e6%a9%9fubuntu%e4%bd%bf%e7%94%a8samba%e5%9c%96%e6%96%87%e6%95%99%e5%ad%b8/">virtualbox虛擬機ubuntu使用samba圖文教學</a></li>
</ul>
<h2 id="SSH-Server"><a href="#SSH-Server" class="headerlink" title="SSH Server"></a>SSH Server</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt-get install ssh -y</span><br><span class="line">vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>
<p>編輯這些參數</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Port 22</span><br><span class="line">PermitRootLogin yes</span><br><span class="line">PasswordAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">AuthorizedKeysFile	.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<p>(可選)如果用root登入需要設定root密碼<br><code>sudo passwd</code><br>重啟ssh<br><code>/etc/init.d/ssh restart</code></p>
<h3 id="參考-4"><a href="#參考-4" class="headerlink" title="參考"></a>參考</h3><ul>
<li><a href="https://www.ewdna.com/2012/06/ubuntu-ssh-server.html">Ubuntu 安裝與設定 ssh server</a></li>
<li><a href="https://askubuntu.com/questions/171521/what-is-the-password-for-ssh-rootlocalhost">What is the password for <code>ssh root@localhost</code>?</a></li>
</ul>
<h2 id="zsh-oh-my-zsh"><a href="#zsh-oh-my-zsh" class="headerlink" title="zsh + oh my zsh"></a>zsh + oh my zsh</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install zsh -y</span><br><span class="line">sudo sh -c <span class="string">&quot;echo <span class="subst">$(which zsh)</span> &gt;&gt; /etc/shells&quot;</span></span><br><span class="line">chsh -s /bin/zsh</span><br><span class="line">apt install git curl -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#oh my zsh</span></span><br><span class="line">curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh | sh -s</span><br><span class="line"></span><br><span class="line"><span class="comment"># plugin zsh-autosuggestions</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions</span><br><span class="line"></span><br><span class="line">vim ~/.zshrc</span><br><span class="line"><span class="comment"># plugins=(git zsh-autosuggestions) plugin添加zsh-autosuggestions</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># plugin zsh-syntax-highlighting</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting</span><br><span class="line"></span><br><span class="line">vim ~/.zshrc</span><br><span class="line"><span class="comment"># plugins=(git zsh-syntax-highlighting) plugin添加zsh-syntax-highlighting</span></span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>
<h3 id="參考-5"><a href="#參考-5" class="headerlink" title="參考"></a>參考</h3><ul>
<li><a href="https://magiclen.org/zsh/">如何在Linux作業系統上使用 Z Shell (Zsh)？</a></li>
<li><a href="https://www.jianshu.com/p/43c1b6e40c69">zsh 命令自动补全插件 zsh-autosuggestions 安装和配置</a></li>
</ul>
<p><code>apt-get iputils-ping net-tools traceroute vim</code> </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&#123;&quot;</span>bip<span class="string">&quot;:&quot;</span>172.15.0.1/16<span class="string">&quot;&#125;&quot;</span> &gt; /etc/docker/daemon.json</span><br><span class="line">systemctl restart docker.service</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>vm</tag>
        <tag>VirtualBox</tag>
        <tag>samba</tag>
        <tag>ssh-server</tag>
      </tags>
  </entry>
  <entry>
    <title>IIC I2C （Inter-Integrated Circuit）</title>
    <url>/2023/11/18/IIC%20I2C%20%EF%BC%88Inter-Integrated%20Circuit%EF%BC%89/</url>
    <content><![CDATA[<h1 id="介紹"><a href="#介紹" class="headerlink" title="介紹"></a>介紹</h1><p><img src="/images/20231119013103.png"><br>I2C(IIC)唸做I-square-C 属于两线式串行总线，由飞利浦公司开发用于微控制器(MCU)和外围设备(从设备)进行通信的一种总线，属于一主多从(一个主设备(Master)，多个从设备(Slave))的总线结构，总线上的每个设备都有一个特定的设备地址，以区分同一I2C总线上的其他设备。</p>
<p>半雙工、同步、串行傳輸，物理上只有兩根線（SDA&#x2F;SCL）；傳輸數據必須8位8位的傳輸</p>
<p>物理I2C接口有<strong>两根双向线</strong>， <strong>串行时钟线（SCL）和串行数据线（SDA）</strong> 组成，可用于发送和接收数据，但是通信都是由主设备发起，从设备被动响应，实现数据的传输。</p>
<h1 id="I2C主设备与从设备的一般通信过程"><a href="#I2C主设备与从设备的一般通信过程" class="headerlink" title="I2C主设备与从设备的一般通信过程"></a>I2C主设备与从设备的一般通信过程</h1><h2 id="起始位-Start-condition-停止位-Stop-condition"><a href="#起始位-Start-condition-停止位-Stop-condition" class="headerlink" title="起始位 Start condition 停止位 Stop condition"></a>起始位 Start condition 停止位 Stop condition</h2><p><img src="/images/20231119013140.png"></p>
<ul>
<li>Start condition: SCL&#x3D; high + SDA falling (SDA由高到低跳變)</li>
<li>Stop condition: SCL&#x3D;high + SDA raising (SDA由低到高跳變)</li>
</ul>
<h2 id="邏輯數據"><a href="#邏輯數據" class="headerlink" title="邏輯數據"></a>邏輯數據</h2><p><img src="/images/20231119013159.png"><br>SCL為High採集SDA數據<br><img src="/images/20231119013218.png"><br>表示1010000  </p>
<h2 id="一-主设备给从设备发送-x2F-写入数据："><a href="#一-主设备给从设备发送-x2F-写入数据：" class="headerlink" title="一. 主设备给从设备发送&#x2F;写入数据："></a>一. 主设备给从设备发送&#x2F;写入数据：</h2><p><img src="/images/20231119013233.png"></p>
<ol>
<li>主设备发送起始（START）信号(1 bit)</li>
<li>主设备发送设备地址到从设备(7&#x2F;8bit) + 寫(1 bit)</li>
<li>等待从设备响应(ACK)(1 bit)</li>
<li>主设备发送数据到从设备，一般发送的每个字节数(8bit)据后会跟着等待接收来自从设备的响应(ACK)(1 bit)</li>
<li>数据发送完毕，主设备发送停止(STOP)信号终止传输(1 bit)</li>
</ol>
<h2 id="二-主设备从从设备接收-x2F-读取数据"><a href="#二-主设备从从设备接收-x2F-读取数据" class="headerlink" title="二. 主设备从从设备接收&#x2F;读取数据"></a>二. 主设备从从设备接收&#x2F;读取数据</h2><p><img src="/images/20231119013244.png"></p>
<ol>
<li>设备发送起始（START）信号(1 bit)</li>
<li>主设备发送设备地址到从设备(7&#x2F;8bit) + 讀(1 bit)</li>
<li>等待从设备响应(ACK)(1 bit)</li>
<li>主设备接收来自从设备的数据，一般接收的每个字节(8bit)数据后会跟着向从设备发送一个响应(ACK)(1 bit)</li>
<li>一般接收到最后一个数据后会发送一个无效响应(NACK)，然后主设备发送停止(STOP)信号终止传输(1 bit)</li>
</ol>
<h2 id="三-讀寫數據幀"><a href="#三-讀寫數據幀" class="headerlink" title="三. 讀寫數據幀"></a>三. 讀寫數據幀</h2><p><img src="/images/20231119013257.png"></p>
<h1 id="參考影片"><a href="#參考影片" class="headerlink" title="參考影片"></a>參考影片</h1><ul>
<li><a href="https://www.youtube.com/watch?v=u62_Rjd5oMY">4分钟看懂！I2C通讯协议 最简单的总线通讯！</a></li>
<li><a href="https://www.youtube.com/watch?v=oPrfi_HCtjY">I²C通訊格式介紹</a></li>
<li><a href="https://www.youtube.com/watch?v=FamlCPP2J4o">11 IIC总线原理轻松明白</a></li>
</ul>
<h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul>
<li><a href="https://zhuanlan.zhihu.com/p/503219395">IIC通信协议，搞懂这篇就够了</a></li>
<li><a href="https://www.strongpilab.com/i2c-introduction/">I2C-協定用法原理簡介-晶片溝通的橋樑</a></li>
<li><a href="https://medium.com/weiting-tw/%E6%8A%80%E8%A1%93%E7%AD%86%E8%A8%98-i2c%E9%80%9A%E8%A8%8A%E5%8D%94%E5%AE%9A%E6%93%8D%E4%BD%9C-36d4dad0c9b3">[技術筆記] I2C通訊協定操作</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/575318033">《Linux驱动：I2C驱动看这一篇就够了》</a></li>
</ul>
]]></content>
      <tags>
        <tag>IIC</tag>
        <tag>I2C</tag>
      </tags>
  </entry>
  <entry>
    <title>Zigbee介紹</title>
    <url>/2023/11/18/Zigbee%E4%BB%8B%E7%B4%B9/</url>
    <content><![CDATA[<ul>
<li><a href="https://blog.csdn.net/u011350258/article/details/113062464">1、ZigBee 开发教程之基础篇—ZigBee简介和学习方法</a></li>
<li><a href="https://zigbeealliance.org/wp-content/uploads/2019/12/Getting-Started-with-Zigbee-3.0-CN.pdf">手把手指南—— 开启你的 Zigbee 之旅</a></li>
<li>Youtube <a href="https://www.youtube.com/playlist?list=PLkc2nflOpCG1jYSnd6gOWpV8XhrlEF-2J">Zigbee</a></li>
<li><a href="https://www.youtube.com/watch?v=iuhY4f_DvfI&ab_channel=TorchIoTBootCamp">Day 1-1 ZigBee基础知识</a></li>
<li><a href="https://blog.csdn.net/lexiyao/article/details/120969009">Zigbee快速入门第二节 – Zigbee基础介绍</a></li>
<li><a href="https://csa-iot.org/wp-content/uploads/2023/04/05-3474-23-csg-zigbee-specification-compressed.pdf">zigbee-specification</a></li>
</ul>
<h1 id="ZigBee基础知识"><a href="#ZigBee基础知识" class="headerlink" title="ZigBee基础知识"></a>ZigBee基础知识</h1><h2 id="What-is-ZigBee"><a href="#What-is-ZigBee" class="headerlink" title="What is ZigBee"></a>What is ZigBee</h2><h3 id="Zigbee"><a href="#Zigbee" class="headerlink" title="Zigbee"></a>Zigbee</h3><p><img src="/images/20231119024254.png"><br>右邊是覆蓋範圍大(10KM) 大多需要被管制的 由運營商主導 城市範圍的覆蓋<br>左邊是覆蓋範圍小(100m) 家庭 樓道用<br>Zigbee 短距離通訊技術 低速通訊技術 最大速度是250Kpbs<br>傳輸控制命令 和 數據採集<br>低功耗的技術 <a href="https://support.tuya.com/zh/help/_detail/K9skz5907xerr">休眠电流在uA級別</a><br>Mesh網路拓譜結構 網路輕鬆擴展 最大節點數 65535(wifi 50 BT 8)<br>2bytes&#x3D;16bits&#x3D;2^16&#x3D;65535<br>zigbee：10-100m，蓝牙：2-10m，Wi-Fi：30-100m</p>
<h3 id="Zigbee網路拓譜"><a href="#Zigbee網路拓譜" class="headerlink" title="Zigbee網路拓譜"></a>Zigbee網路拓譜</h3><p>Star(WiFi) vs Mesh(Zigbee) 主要差別在有無中心節點，中心節點壞了就不能正常工作</p>
<p>Zigbee(star mesh tree)<br><img src="/images/20231119024320.png"></p>
<h3 id="Zigbee-歷史"><a href="#Zigbee-歷史" class="headerlink" title="Zigbee 歷史"></a>Zigbee 歷史</h3><p><img src="/images/20231119024339.png"><br>2003年 Zigbee誕生<br>2016年 發布Zigbee3.0(整合統一之前的標準)</p>
<p><a href="https://www.51cto.com/article/496376.html">ZigBee 3.0版标准，强化低延迟与低功耗优势，并加入网际网路通讯协定(IP)支援能力</a></p>
<p>ZigBee完全相容Wi-Fi&#x2F;IP</p>
<p>ZigBee 3.0完全相容IP。ZigBee设备与Wi-Fi设备类似，通常透过路由器、闸道或机上盒连接到互联网，让人可在世界其他地方利用连接互联网的个人电脑、平板或智慧手机应用程式等任何其他设备实现即时控制(图3)。由于ZigBee完全相容Wi-Fi和IP，因此没必要在手机本身插入ZigBee晶片，从而发现和控制ZigBee连接的智慧家居和物联网设备。只要通过任何联网中心均可让这一切实现，这意味着，透过Wi-Fi或蜂窝网进行联网的个人电脑和智慧手机可以作为指示板，并可毫不费力发现并与其他ZigBee设备进行通讯。</p>
<p><a href="https://blog.csdn.net/mengqidluffy/article/details/116061885">小白也能读懂的 ZigBee 3.0 简介</a></p>
<h3 id="Zigbee-聯盟"><a href="#Zigbee-聯盟" class="headerlink" title="Zigbee 聯盟"></a>Zigbee 聯盟</h3><p><img src="/images/20231119024356.png"><br>推广Zigbee技术的主要力量。这是一个开放的组织。任何公司都可以加入Zigbee联盟作为成员。Silicon Labs是Zigbee联盟的董事会成员。</p>
<ul>
<li>为IoT（物联网）的无线设备端到设备端的通信制定开放的全球标准</li>
<li>通过我们的认证计划对产品进行认证，以帮助确保互操作性(產品和平台的認證)</li>
<li>在全球范围内推广我们的标准</li>
</ul>
<p><img src="/images/20231119024412.png"><br>Zigbee聯盟更名，同步推出與亞馬遜、蘋果及Google共同制定連接標準Matter</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="Zigbee協議"><a href="#Zigbee協議" class="headerlink" title="Zigbee協議"></a>Zigbee協議</h3><p><img src="/images/20231119024438.png"><br>基於<a href="https://baike.baidu.hk/item/IEEE%20802.15.4/6657379">IEEE802.15.4</a>標準基礎上定義<br>MAC層和物理層沿用IEEE802.15.4標準<br>網路層 APS層(Application Support Sub Layer) 應用層 是Zigbee定義的標準</p>
<p>網路層和APS層有加密的特性:加密 驗證 重傳保護</p>
<ul>
<li>物理層 由晶片實現 無線電的收發管理 調製解調</li>
<li>MAC層 一半硬體 一辦軟體實現 數據收發 確認 重傳 掃描</li>
<li>網路層 路由 設備狀狀態維護 子節點管理</li>
<li>APS層 端到端重傳和確認 </li>
<li>應用層 ZDO(ZigBee Device Object 特殊的設備管理功能) User應用</li>
</ul>
<p>灰色部分是晶片處理<br>綠色是平台供應商實現<br>橘色是應用層開發</p>
<blockquote>
<p>IEEE 802.15.4是一種技術標準，它定義了低速率無線個域網 （LR-WPAN）的協議。 它規定了LR-WPAN的物理層和媒體訪問控制 ，並由IEEE 802.15工作組維護，該工作組在2003年定義了該標準。它是Zigbee的基礎，諸如 ISA100.11a ， WirelessHART ， MiWi ， 6LoWPAN ，<br>PAN 個人區域網路</p>
</blockquote>
<h3 id="Zigbee物理層"><a href="#Zigbee物理層" class="headerlink" title="Zigbee物理層"></a>Zigbee物理層</h3><p><img src="/images/20231119024455.png"></p>
<h4 id="工作範圍在-2-4GHz-868MHz-915MHz"><a href="#工作範圍在-2-4GHz-868MHz-915MHz" class="headerlink" title="工作範圍在 2.4GHz 868MHz 915MHz"></a>工作範圍在 2.4GHz 868MHz 915MHz</h4><ul>
<li>2.4GHz  全球通用 250kpbs 11-26通道 2400MHz~2600MHz 每5MHz一個通道</li>
<li>868MHz 英國電表 水表(Smart Engery) 20kpbs 0通道 </li>
<li>915MHz 北美Zigbee 40kpbs 1-10通道 每2MHz一個通道</li>
</ul>
<h4 id="物理層功能"><a href="#物理層功能" class="headerlink" title="物理層功能"></a>物理層功能</h4><ul>
<li>物理无线和MAC层的接口</li>
<li>無線電收發管理</li>
<li>无线电开&#x2F;关控制</li>
<li>调制与解调</li>
<li>信道选择</li>
<li>链接质量估算</li>
<li>能量检测</li>
<li>功率調節</li>
</ul>
<h4 id="Zigbee-和-WIFI-共存"><a href="#Zigbee-和-WIFI-共存" class="headerlink" title="Zigbee 和 WIFI 共存??"></a>Zigbee 和 WIFI 共存??</h4><p><img src="/images/20231119024508.png"><br>Zigbee 和 WIFI 都使工作在2.4GHz 底下 會存在相互干擾的情況<br><a href="https://www.ebyte.com/new-view-info.aspx?id=1082">怎样设置Zigbee和wifi信道避免干扰？</a><br><a href="https://bbs.16rd.com/thread-574907-1-1.html">Zigbee和Wi-Fi的干擾和共存</a><br><a href="https://www.mwrf.net/tech/rfic/2020/27496.html">在2.4GHz共存-WLAN、蓝牙、ZigBee和Thread在2.4GHz频段共存</a></p>
<h3 id="Zigbee-MAC層"><a href="#Zigbee-MAC層" class="headerlink" title="Zigbee MAC層"></a>Zigbee MAC層</h3><h4 id="MAC幀"><a href="#MAC幀" class="headerlink" title="MAC幀"></a>MAC幀</h4><p><img src="/images/20231119024520.png"><br>前面PERAMBLE SPD PHYHeader 由物理層封裝<br>Frame Control(2bytes):標示frame類型</p>
<ul>
<li>Beacon 掃描網路</li>
<li>Data 上層數據</li>
<li>ACK 確認用</li>
<li>MAC Command 入網時候使用的命令 MAC关联过程。<br>CRC(最後2bytes): 驗證資料包的完整性 (空氣中傳播 受到干擾 資料會丟掉)</li>
</ul>
<h4 id="MAC-傳送確認"><a href="#MAC-傳送確認" class="headerlink" title="MAC 傳送確認"></a>MAC 傳送確認</h4><p><img src="/images/20231119024532.png"><br>MAC层还为节点提供了一种方法，该方法可通过确认得知节点已成功接收到1跳单播传输，并且已通过验证CRC保留了所传输消息的完整性。 多跳传输应在每个跳上进行确认。节点执行CCA检查并发送消息后，它会等待MAC确认。如果未收到消息，则该节点应尝试多次重发该消息，直到其最终成功或最大的重试次数已用尽。<br><img src="/images/20231119024545.png"><br>從NodeA到NodeD發送資料通常是應用層和應用層的傳送<br>NodeA 傳到到 NodeB 確認收到回傳MAC Ack 到 NodeA<br>不是NobeB接收的資料(資料最多在網路層) 往NodeC傳直到傳到正確的接收方<br>NodeD正確的接收要回傳APS Ack確認回NodeA</p>
<p>兩種不同的確認 如果沒收到Ack就會重傳</p>
<ul>
<li>MAC Ack 是點跟點的確認</li>
<li>APS Ack 是端到端的確認</li>
</ul>
<h4 id="CSMA-x2F-CA-避免干擾"><a href="#CSMA-x2F-CA-避免干擾" class="headerlink" title="CSMA&#x2F;CA 避免干擾"></a><a href="https://zhuanlan.zhihu.com/p/51412066">CSMA&#x2F;CA 避免干擾</a></h4><p>Listen Before Talk 發送資料前聽一下<br>判斷channel是否有人在使用<br>802.15.4允许多个网络位于同一通道上。因此，需要采取某种方式来避免来自不同网络的数据包在空中碰撞而造成通信错误。MAC子层使用CSMA-CA（Carrier Sense Multiple Access&#x2F;Collision Avoidance）控制对无线电的访问。避免碰撞是通过CCA（Clear Channel Assessment）完成的。在发送之前，每个节点必须检查电波是否可以正常发送（RSSI低于CCA阈值）。如果是，则节点应继续进行并在进行少量随机退避后进行传输。如果CCA没有通过，则该节点应等待多个退避周期，然后才能再次尝试该过程。随机退避允许多个节点交错传输，因此它们总是可以在某个时间点找到干净的无线空间来作数据传输。尽管比特率很低，因为数据包比较小（128 bytes），即使在非常嘈杂的信道上每一个节点也可以成功地完成数据传输。</p>
<p><a href="https://www.youtube.com/watch?v=wXbcBSQDnFA">CSMA&#x2F;CD</a> 兩種解決碰撞問題的機制<br>CSMA(Carrier Sense Mutiple Access) 防止碰撞機制 先偵測Hub上有無通訊 無才可通訊<br>CD(Collision Detection) 偵測碰撞 當偵測碰撞到碰撞時，發出JAM訊號 清空資料 再用 後退演算法錯開<br>CA(Collision Avoidance) 避免碰撞<br><a href="https://wiki.mbalib.com/zh-tw/CSMA/CA">CSMA&#x2F;CA</a></p>
<blockquote>
<p>CSMA&#x2F;CA是先聽一下附近有沒有人講話，沒有人講話再講話<br>CSMA&#x2F;CD是不管了直接傳，發現打斷其他人講話時就回來等一下再傳</p>
</blockquote>
<p>(一)差異： </p>
<ol>
<li>CSMA&#x2F;CD主要應用在有線網路，CSMA&#x2F;CA主要應用在無線網路。</li>
<li>CSMA&#x2F;CD是使用碰撞偵測處理(Collision Detection)，在有線網路的環境中，可以檢測碰撞，但不容易去 避免。CSMA&#x2F;CA是使用避免碰撞處理(Collision Avoidance)，在無線網路的環境中，要使用CD去偵測碰 撞是困難的，所以在無線網路中採取CA的方式避免碰撞。 </li>
<li>CSMA&#x2F;CD的傳輸效率較佳，但硬體成本比較高。CSMA&#x2F;CA的傳輸效率較差，但硬體成本比較低。<br>(二)運作過程： </li>
<li>CSMA&#x2F;CD是在偵測是否有通道空閒後，在發送資料時同時進行防止Collision的檢查，如果在發送數據過 程中檢測到衝突，就立即停止發送資料，並等待一段時間，再重新發送碰撞的資料。</li>
<li>CSMA&#x2F;CA在送出資料前，先送RTS封包確認或是聆聽網路上的狀態，若沒有人使用，等待一段時間後， 如果還沒有人使用，才送出資料。</li>
</ol>
<h3 id="Zigbee-網路層"><a href="#Zigbee-網路層" class="headerlink" title="Zigbee 網路層"></a>Zigbee 網路層</h3><h4 id="裝置類型"><a href="#裝置類型" class="headerlink" title="裝置類型"></a>裝置類型</h4><p><img src="/images/20231119024603.png"></p>
<ul>
<li>Coordinator 協調員<ul>
<li>一個Zigbee網路只能有一個</li>
<li>創建網路  第一個成員 地址為0x000</li>
<li>可以路由 添加成員</li>
<li>不能睡眠</li>
</ul>
</li>
<li>Router 路由<ul>
<li>可以路由</li>
<li>不能睡眠</li>
</ul>
</li>
<li>End Device&#x2F; Sleepy End Device 終端設備<ul>
<li>必須附著在 Coordinator 或 Router 上</li>
<li>不能路由 只能接收</li>
<li>可睡眠</li>
</ul>
</li>
</ul>
<h4 id="Device-Announce-加入網路時所發送的訊息"><a href="#Device-Announce-加入網路時所發送的訊息" class="headerlink" title="Device Announce (加入網路時所發送的訊息)"></a>Device Announce (加入網路時所發送的訊息)</h4><p><img src="/images/20231119024617.png"><br>Device Type(IEEE-802.15.4定义了两种设备类型)：</p>
<ul>
<li>FFD(Full Function Device), 全功能设备，能够执行IEEE 802.15.4标准中描述的所有职责，并且可以在网络中担任任何角色。Coordinator&#x2F;Router</li>
<li>RFD(Reduced Function Device), 剪裁功能设备，功能有限。 End Device&#x2F; Sleepy End Device</li>
</ul>
<blockquote>
<p>RFD设备的处理能力和内存大小通常小于FFD设备。<br><img src="/images/20231119024634.png"><br>Alternate PAN Coordination 標示是否為 Coordinator<br><img src="/images/20231119024648.png"><br>Power Source Main 電源供電或者電池供電</p>
</blockquote>
<h4 id="網路地址-Addressing-PAN-ID-and-xPan-ID-Extended-PAN-ID"><a href="#網路地址-Addressing-PAN-ID-and-xPan-ID-Extended-PAN-ID" class="headerlink" title="網路地址 Addressing PAN ID and (xPan ID)Extended PAN ID"></a>網路地址 Addressing PAN ID and (xPan ID)Extended PAN ID</h4><p><img src="/images/20231119024701.png"></p>
<ul>
<li>PAN ID: 短的(不唯一) 16bit 由用戶或Coordinator隨機生成 用於mac層過濾用 0xFFFF 用於廣播 </li>
<li>xPan ID: 長的(唯一值) Coordinator隨機生成 只有在Beacon會傳送  用於解決PAN ID衝突</li>
</ul>
<blockquote>
<p>低速通訊技術 250kpbs 有效數據負荷占比低(mac頭部 network頭部…) 如果每次用64bit效數據負荷占比低 所以用短的網路地址</p>
</blockquote>
<blockquote>
<p>mac層收到不是自己的PAN ID 就丟掉</p>
</blockquote>
<p><img src="/images/20231119024719.png"><br>☝️Beacon的封包</p>
<h4 id="設備地址-Addressing-Node-ID-and-IEEE-Address"><a href="#設備地址-Addressing-Node-ID-and-IEEE-Address" class="headerlink" title="設備地址 Addressing Node ID and IEEE Address"></a>設備地址 Addressing Node ID and IEEE Address</h4><ul>
<li>Node ID(Short ID) 16bits加入網路時父節點分配 可能會衝突</li>
<li>IEEE Address(Long ID) 64bits (MAC Address) 出廠就設定好 解決Node ID衝突<br>再傳送的時候用NodeID傳送<br>如果出現衝突就更改NodeID</li>
</ul>
<h3 id="Zigbee-應用層"><a href="#Zigbee-應用層" class="headerlink" title="Zigbee 應用層"></a>Zigbee 應用層</h3><h4 id="EndPoint-有點像Port的概念-範圍0-255"><a href="#EndPoint-有點像Port的概念-範圍0-255" class="headerlink" title="EndPoint 有點像Port的概念 範圍0-255"></a>EndPoint 有點像Port的概念 範圍0-255</h4><p><img src="/images/20231119024733.png"></p>
<p>EndPoint 1-239 用戶開發用<br>EndPoint 0, 240-255 保留用 0(ZDO Zigbee設備管理用) 255 廣播所有EndPoint</p>
<p>Endpoints存在於每個節點中，以1~240的數字編號，<br>每個endpoint定義了一個在ZigBee節點上運行的application<br>(一個node可以有多個applications，也就是多個endpoints)</p>
<p>Endpoints的三個用途：</p>
<ul>
<li>允許不同的app profiles存在於一個節點</li>
<li>允許一個節點中的不同控制點</li>
<li>允許一個節點中有不同的devices<br><img src="/images/20231119024755.png"><br>通訊是 EndPoint to EndPoint<br>一個當 Client 一個當 Server<br>通訊內容是由<strong>Cluster</strong>格式定義<br><img src="/images/20231119024811.png"><br>Cluster: 通訊Model<br>Client&#x2F;Server model<br>每一個Cluster定義一個功能(On&#x2F;Off Cluster、Level Cluster) ZCL(Zigbee Cluster Library)<br>定義命令和屬性<br><img src="/images/20231119024826.png"><br>以控制燈開關為例 開關為Client 燈為Server<br>On&#x2F;Off Cluster:<br>Commend: OnOff、Toggle<br>Attribute: On、Off</li>
</ul>
<blockquote>
<p>Cluster大多定義好了功用的 但也可以客製化定義 但這樣就不通用</p>
</blockquote>
<h2 id="安全特性-偽造-重傳"><a href="#安全特性-偽造-重傳" class="headerlink" title="安全特性(偽造 重傳)"></a>安全特性(偽造 重傳)</h2><h3 id="應用層安全"><a href="#應用層安全" class="headerlink" title="應用層安全"></a>應用層安全</h3><p><img src="/images/20231119024856.png"><br>將Applocation層的Payload加密 中間加安全頭部 然後算出Hash值 加到最後面往下傳<br>通過檢查Hash值(APS MIC)檢查應用層有無被篡改</p>
<h3 id="網路層安全"><a href="#網路層安全" class="headerlink" title="網路層安全"></a>網路層安全</h3><p><img src="/images/20231119024909.png"><br>將Network層的Payload加密 中間加安全頭部 然後算出Hash值 加到最後面往下傳<br>通過檢查Hash值(NWK MIC)檢查應用層有無被篡改</p>
<blockquote>
<p>應用層網路層對稱加密: AES128<br><img src="/images/20231119024953.png"><br>安全頭部(APS Auxiliary HDR、NWK Auxiliary HDR)有Frame Counter防止重傳</p>
</blockquote>
<h3 id="Frame-Counter-防止重傳"><a href="#Frame-Counter-防止重傳" class="headerlink" title="Frame Counter 防止重傳"></a>Frame Counter 防止重傳</h3><p><img src="/images/20231119025007.png"><br>接收端會記錄收到的 FrameCounter 如果接收到一樣就會丟掉封包 (只會紀錄周圍節點的FrameCounter)<br>發送端每次發送封包時會將 FrameCounter++ 達到每次FrameCounter都不一樣</p>
<h3 id="安全特點-端到端-點到點"><a href="#安全特點-端到端-點到點" class="headerlink" title="安全特點 端到端 點到點"></a>安全特點 端到端 點到點</h3><p><img src="/images/20231119025021.png"><br>NodeA傳到NodeC 中間NodeB不會去解開APS層的資料 NodeB只會解開網路層的資料<br>APS層是 端到端 端跟端之間有秘鑰(Link Key)<br>網路層是 點到點 點跟點之間有秘鑰(NWK Key)</p>
<h3 id="NWK-Key"><a href="#NWK-Key" class="headerlink" title="NWK Key"></a>NWK Key</h3><p><img src="/images/20231119025033.png"></p>
<ul>
<li>整個網路用的NWK Key都是一樣</li>
<li>在創建網路時隨機生成 16-byte</li>
<li>NWK 靠應用層加密傳輸</li>
<li>Trust Center: 提供NWK Key的裝置(通常是Coordinator)</li>
<li>有兩種模式 Centralized Distrbuted</li>
</ul>
<h4 id="傳送-NWK-Key"><a href="#傳送-NWK-Key" class="headerlink" title="傳送 NWK Key"></a>傳送 NWK Key</h4><h3 id="Link-Key"><a href="#Link-Key" class="headerlink" title="Link Key"></a>Link Key</h3><ul>
<li>16-byte</li>
<li>Trust Center Link Key 新設備加入網路傳送NWK key</li>
<li>(install code[出廠設定] + 算法) 或 (<strong>ZigbeeAlliance09</strong>)</li>
</ul>
<h4 id="install-code-是透過人工完成的-更安全"><a href="#install-code-是透過人工完成的-更安全" class="headerlink" title="install code 是透過人工完成的 更安全"></a>install code 是透過人工完成的 更安全</h4><p><img src="/images/20231119025052.png"></p>
<h2 id="加入網路"><a href="#加入網路" class="headerlink" title="加入網路"></a><a href="https://blog.csdn.net/lee_jimmy/article/details/109162896">加入網路</a></h2><h3 id="通用Link-Key-ZigbeeAlliance09"><a href="#通用Link-Key-ZigbeeAlliance09" class="headerlink" title="通用Link Key(ZigbeeAlliance09)"></a>通用Link Key(ZigbeeAlliance09)</h3><p><img src="/images/20231119025110.png"></p>
<ul>
<li>Coordinator 創建網路 設定PAN ID、xPAN ID、通道、功率</li>
<li>設備可以加入網路</li>
<li>掃描網路，新設備在每個通道發起Beacon Request等待有無回應 無回應往下一個通道發Beacon Request (因為不知道所以全發)</li>
<li>Coordinator收到Beacon Request回覆 一個Beacon(包含PAN ID xPAN ID…)</li>
<li>設備可能會收到很多Beacon，選擇用rssi最強當作父節點 再發送Association Request 包含(自己設備的能力…)</li>
<li>父節點發送Association Response(分配給他沒人用 Node ID)</li>
<li>等待接收NWK Key (Trust Center 會用Link Key(ZigbeeAlliance09)加密NWK Key) 用ZigbeeAlliance09解密</li>
<li>router会发送一个device announce的报文（从目的地址为广播地址可以看出）通知全网，我入网了、我的设备信息都有哪些。</li>
<li>之後就可以通訊了</li>
</ul>
<h3 id="使用Install-Code"><a href="#使用Install-Code" class="headerlink" title="使用Install Code"></a>使用Install Code</h3><p><img src="/images/20231119025123.png"></p>
<ul>
<li>Coordinator 創建網路 設定PAN ID、xPAN ID、通道、功率</li>
<li>設備可以加入網路</li>
<li>Coordinator 掃描 新設備Install Code建立Link Key</li>
<li>掃描網路，新設備在每個通道發起Beacon Request等待有無回應 無回應往下一個通道發Beacon Request (因為不知道所以全發)</li>
<li>Coordinator收到Beacon Request回覆 一個Beacon(包含PAN ID xPAN ID…)</li>
<li>設備可能會收到很多Beacon，選擇用rssi最強當作父節點 再發送Association Request 包含(自己設備的能力…)</li>
<li>父節點發送Association Response(分配給他沒人用 Node ID)</li>
<li>等待接收NWK Key (Trust Center 會用Link Key(由掃描到的Install Code建立)加密NWK Key) 用設備上的Install Code產生Link Key解密</li>
<li>router会发送一个device announce的报文（从目的地址为广播地址可以看出）通知全网，我入网了、我的设备信息都有哪些。</li>
<li>之後就可以通訊了</li>
</ul>
<p><a href="https://blog.csdn.net/u012993936/article/details/88225371">Zigbee抓包工具</a></p>
<ul>
<li>Packet Sniffer</li>
<li>Ubiqua</li>
<li>Wireshark <ul>
<li><a href="https://segmentfault.com/a/1190000041469759">手把手教你如何通过CC2531抓取Zigbee包，并解析加密Zigbee包</a></li>
<li><a href="https://www.twblogs.net/a/5b8f25562b717718834a0ac9">使用CC2531 USB Dongle 抓取小米Zigbee智能硬件數據包</a></li>
<li><a href="https://www.ruten.com.tw/find/?q=+CC2531">露天CC2531</a></li>
<li><a href="https://www.twblogs.net/a/5c80fb1fbd9eee35fc136d05">如何用Wireshark對Zigbee進行抓包分析</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/489493842">ZigBee 无线报文的抓取与分析</a></li>
<li><a href="https://item.taobao.com/item.htm?id=657969866117">USB Dongle CC2530 CC2531 ZigBee 协议栈 分析 抓包 工具 模块</a></li>
<li><a href="http://bbs.sunsili.com/thread-226165-1-1.html">利用Wireshark对Zigbee进行抓包分析</a></li>
</ul>
</li>
</ul>
<h2 id="认识Profile和Cluster"><a href="#认识Profile和Cluster" class="headerlink" title="认识Profile和Cluster"></a><a href="https://blog.csdn.net/yanwumuxi/article/details/123866005">认识Profile和Cluster</a></h2><p><a href="https://community.nxp.com/pwmxy87654/attachments/pwmxy87654/wireless-connectivity/698/1/075367r03ZB_AFG-Home_Automation_Profile_for_Public_Download.pdf">Zigbee Profile</a><br><img src="/images/20231119025145.png"></p>
<hr>
<h3 id="Silicon-Labs-GeckoSDK"><a href="#Silicon-Labs-GeckoSDK" class="headerlink" title="Silicon Labs GeckoSDK"></a>Silicon Labs GeckoSDK</h3><ul>
<li><a href="https://www.silabs.com/documents/public/user-guides/ug491-zigbee-app-framework-dev-guide-sdk-7x.pdf">zigbee-app-framework-dev-guide-sdk-pdf</a></li>
<li><a href="https://community.silabs.com/s/question/0D58Y00008aZEGPSA4/hello-im-working-on-a-zigbee-minimals-project-with-the-efr32-xxx-and-i-would-like-to-ask-you-how-to-create-a-callback-to-do-an-action-every-5-minutes-thank-you?language=zh_TW">New Callback</a></li>
<li><a href="https://github.com/SiliconLabs/IoT-Developer-Boot-Camp/wiki/Zigbee-Boot-Camp">Zigbee-Boot-Camp</a></li>
<li><a href="https://www.silabs.com/wireless/zigbee/efr32mg24-series-2-modules/device.mgm240pa32vnn?tab=specs">MGM240PA32VNN</a></li>
<li><a href="https://blog.csdn.net/lexiyao/article/details/109153280">Zigbee应用程序框架开发指南 - 概述</a></li>
<li><a href="https://www.sekorm.com/news/30245981.html">【经验】EmberZnet CLI指令之绑定功能实现过程</a></li>
<li><a href="https://blog.csdn.net/yanwumuxi/article/details/123866005">Zigbee Profile</a></li>
<li><a href="https://community.silabs.com/s/article/zigbee-3-0-tutorial-light-and-switch-from-scratch-step-5?language=en_US">ZigBee 3.0 Tutorial - Light and Switch from Scratch</a></li>
<li><a href="https://github.com/SiliconLabs/zigbee_applications/tree/a90ebc1e6a06ac7dd1e158f435f58e910595a477">zigbee_applications example</a></li>
<li><a href="https://space.bilibili.com/641942011/channel/seriesdetail?sid=726018">bilibili</a></li>
<li><a href="https://workshop.siliconforce.com/?p=862">Silicon Labs EFM8 的 Hello World 程式</a></li>
</ul>
<hr>
<h3 id="TI-Z-Stack"><a href="#TI-Z-Stack" class="headerlink" title="TI Z-Stack"></a>TI Z-Stack</h3><ul>
<li><a href="https://www.ti.com/zh-tw/homepage.html">Texas Instruments</a></li>
<li><a href="https://software-dl.ti.com/simplelink/esd/plugins/simplelink_zigbee_sdk_plugin/1.60.01.09/exports/docs/zigbee_user_guide/html/zigbee/introduction.html">TI Z-Stack User Guide</a></li>
<li><a href="https://www.bilibili.com/video/BV1d94y117kj/">ZigBee开发-嵌入式物联网开发教程学习</a></li>
<li><a href="https://blog.csdn.net/yanwumuxi/article/details/126485087">Zigbee学习（三）Z-Stack代码框架解析</a></li>
<li><a href="https://blog.csdn.net/yanwumuxi/article/details/131128082">Zigbee学习（四）入网流程及抓包分析</a></li>
<li><a href="https://docs.wireless-tech.cn/doc/101/">Zigbee驱动安装-抓包环境搭建</a></li>
<li><a href="https://blog.csdn.net/lixiaocheng1983/article/details/123090679?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-5-123090679-blog-88225371.235%5Ev38%5Epc_relevant_sort_base1&spm=1001.2101.3001.4242.4&utm_relevant_index=8">手把手教你如何通过CC2531抓取Zigbee包，并解析加密Zigbee包</a></li>
</ul>
<hr>
<h3 id="zigpy"><a href="#zigpy" class="headerlink" title="zigpy"></a>zigpy</h3><p><a href="https://github.com/zigpy/zigpy">zigpy</a><br><a href="https://github.com/zigpy/zigpy-cli">zugpy-cli</a></p>
<h3 id="ZDO"><a href="#ZDO" class="headerlink" title="ZDO"></a><a href="https://www.wpgdadatong.com/question/detail/15822">ZDO</a></h3><p>提供了所有ZigBee设备共同的特殊应用，以管理已描述的各种过程。此应用程序是ZigBee设备对象或ZDO。它位于节点的应用层，并且可以使用 ZigBee设备配置文件（ZDP）和相关 cluster通过端点0与远程节点通信。它具有以下作用：</p>
<ol>
<li>定义网络设备的类型：协调器、路由器或终端设备</li>
<li>初始化节点以允许应用程序运行。</li>
<li>执行设备发现和服务发现过程。</li>
<li>实现允许协调器创建网络以及路由器和终端设备加入和离开网络所需的过程。</li>
<li>启动并响应绑定请求。</li>
<li>启动并响应绑定请求提供允许在应用程序之间建立安全关系的安全服务。</li>
<li>允许远程节点从节点检索信息，如路由表和绑定表，并执行节点的远程管理，如指示它离开网络。</li>
</ol>
<p>ZDO使用堆栈内的服务来实现这些角色，并提供了一种允许用户应用程序访问堆栈服务的方法。</p>
<p><a href="https://blog.csdn.net/qq_35413125/article/details/116986028">ZigBeePro协议栈词汇名词解释</a></p>
<p><a href="https://blog.csdn.net/Msymbol/article/details/111194158">Thread协议介绍</a><br><a href="https://iknow.stpi.narl.org.tw/Post/Read.aspx?PostID=10327">Thread可能取代Zigbee -ZHA並衝擊智慧家庭的通訊標準</a><br><a href="https://www.kocpc.com.tw/archives/476397">無線技術 Thread 是什麼？它會是智慧家庭的未來嗎？</a><br><a href="https://turadise.com/matter-thread/">Matter智慧家庭控制標準協定,用Thread整合智能居家控制系統</a></p>
]]></content>
      <tags>
        <tag>Zigbee</tag>
        <tag>IEEE802154</tag>
      </tags>
  </entry>
  <entry>
    <title>git@github.com Permission denied (publickey)</title>
    <url>/2023/05/05/git-github-com-Permission-denied-publickey/</url>
    <content><![CDATA[<p>git clone permission denied(publickey)<br><img src="/images/pasted-0.png"><br>原因：git clone 沒有ssh的publickey<br>解決：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure>

<p>如果沒有產生過公鑰，會產下面錯誤</p>
<blockquote>
<p>cat: &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub: No such file or directory</p>
</blockquote>
<p>使用ssh-keygen產公鑰(遇到提示按Enter)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure>

<p>將印出來的公鑰設定去<a href="https://github.com/settings/ssh/new">SSH Add New Key</a> or (GitHub &gt;&gt; Settings &gt;&gt; SSH and GPG keys &gt;&gt; New SSH key)<br><img src="/images/pasted-2.png"></p>
]]></content>
  </entry>
  <entry>
    <title>實作 Nginx 負載平衡 load balance</title>
    <url>/2023/04/09/%E5%AF%A6%E4%BD%9C%20Nginx%20%E8%B2%A0%E8%BC%89%E5%B9%B3%E8%A1%A1%20load%20balance/</url>
    <content><![CDATA[<h2 id="三種-load-balancing-方法"><a href="#三種-load-balancing-方法" class="headerlink" title="三種 load balancing 方法"></a>三種 load balancing 方法</h2><ol>
<li>round-robin：預設值，會將請留輪流平均分配到每台伺服器上</li>
<li>lest-connected：會將請求分配到目前連接數最少的伺服器上</li>
<li>ip-hash：利用 hash-function 來決定使用者要被分配到的伺服器，此方法可以達到同一個使用者 (IP address) 每次連結的伺服器都是相同的</li>
</ol>
<h2 id="設定不同付載平衡模式"><a href="#設定不同付載平衡模式" class="headerlink" title="設定不同付載平衡模式"></a>設定不同付載平衡模式</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">	upstream myapp &#123;</span><br><span class="line">		ip_hash; #付載平衡模式 round-robin(default 不寫), lest_conn , ip-hash</span><br><span class="line">		server srv1.example.com;</span><br><span class="line">		server srv2.example.com;</span><br><span class="line">		server srv3.example.com;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	server &#123;</span><br><span class="line">		listen 80;</span><br><span class="line"></span><br><span class="line">		location / &#123;</span><br><span class="line">			proxy_pass	 http://myapp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Round-robin-分配權重-weight"><a href="#Round-robin-分配權重-weight" class="headerlink" title="Round-robin 分配權重 weight"></a>Round-robin 分配權重 weight</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">	upstream myapp &#123;</span><br><span class="line">		server srv1.example.com weight=3;</span><br><span class="line">		server srv2.example.com weight=2;</span><br><span class="line">		server srv3.example.com;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	server &#123;</span><br><span class="line">		listen 80;</span><br><span class="line"></span><br><span class="line">		location / &#123;</span><br><span class="line">			proxy_pass	 http://myapp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="備份-backup-backup-代表，所有伺服器都掛掉之後，此伺服器才會生效"><a href="#備份-backup-backup-代表，所有伺服器都掛掉之後，此伺服器才會生效" class="headerlink" title="備份 backup backup 代表，所有伺服器都掛掉之後，此伺服器才會生效"></a>備份 backup backup 代表，所有伺服器都掛掉之後，此伺服器才會生效</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">	upstream myapp &#123;</span><br><span class="line">		server srv1.example.com weight=3;</span><br><span class="line">		server srv2.example.com backup;</span><br><span class="line">		server srv3.example.com;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	server &#123;</span><br><span class="line">		listen 80;</span><br><span class="line"></span><br><span class="line">		location / &#123;</span><br><span class="line">			proxy_pass	 http://myapp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h1><ul>
<li><a href="maxlist.xyz/2020/06/18/flask-nginx/">maxlist.xyz&#x2F;2020&#x2F;06&#x2F;18&#x2F;flask-nginx&#x2F;</a></li>
</ul>
]]></content>
  </entry>
</search>
