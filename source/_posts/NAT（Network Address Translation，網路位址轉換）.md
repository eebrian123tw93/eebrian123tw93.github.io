---
title: NAT（Network Address Translation，網路位址轉換）
categories: []
date: '2024-12-23 11:47:00'
updated: '2025-02-19 08:51:02'
description: ''
abbrlink: 7727d3af
tags:
  - WebRTC
keywords:
  - WebRTC
---
NAT（Network Address Translation，網路位址轉換）是一種網路技術，用於將內部網路的私有IP地址轉換為公共IP地址，或反向轉換。這項技術的主要目的是讓多台內部設備能夠共享一個或少量公共IP地址進行外部網路通信，同時提高網路安全性。

### NAT 的主要功能：

1. **地址重用**：通過使用私有IP地址，節省了公共IP地址的資源。
2. **隱藏內部網路結構**：外部設備無法直接訪問內部設備，提高了安全性。
 <!-- more -->
 3. **負載分擔**（可選）：某些高級NAT設備可以實現多條外部連接的負載均衡。

### NAT 的類型：

1. **靜態NAT（Static NAT）**：
    
    - 一對一地將私有IP地址映射到公共IP地址。
    - 用於需要外部設備直接訪問內部設備的情況。
2. **動態NAT（Dynamic NAT）**：
    
    - 使用一組公共IP地址，根據需求動態分配給內部設備。
    - 不保證每個內部設備都有固定的公共IP。
3. **PAT（Port Address Translation）** 或稱「NAPT」：
    
    - 多對一的NAT，也叫「多工NAT」。
    - 通過改變傳輸層的端口號讓多個內部設備共享一個公共IP地址。
    - 是家庭路由器最常見的NAT形式。

### NAT 的工作原理：

1. **請求發送（內部到外部）：**
    
    - 當內部設備向外部網路發送請求時，NAT設備會將內部的私有IP地址和端口號轉換為公共IP地址和新的端口號。
    - NAT設備在內部維護一個映射表，用於跟蹤這些轉換。
2. **響應接收（外部到內部）：**
    
    - 當外部網路的響應到達NAT設備時，NAT設備根據映射表將公共IP地址和端口號還原為內部的私有IP地址和端口號，然後將數據包轉發到內部設備。

### 使用場景：

- **家庭或企業網路**：讓多台設備共享一個ISP分配的公共IP地址。
- **伺服器部署**：在某些情況下，需要靜態NAT來將特定公共IP地址映射到內部伺服器。

NAT 雖然能節省IP資源和提升安全性，但也可能導致某些應用（例如P2P網路或VoIP）運行效率降低，因為這些應用依賴於直接的端到端通信。

# NAT（网络地址转换）分为以下四种类型
### 1. **完全圆锥型 NAT（Full Cone NAT）**

- **特性**：
    
    - 一个内部地址和端口与一个外部地址和端口一一对应。
    - 任何外部设备都可以通过已映射的外部地址和端口发送数据包到内部设备。
    - 无需特定的访问限制。
- **优点**：
    
    - 连接容易建立，适合P2P和VoIP应用。
- **缺点**：
    
    - 安全性较低，因为任何外部主机都可以通过已映射的端口访问内部设备。

---

### 2. **受限圆锥型 NAT（Restricted Cone NAT）**

- **特性**：
    
    - 一个内部地址和端口与一个外部地址和端口一一对应。
    - 只有在内部设备主动发送数据包给外部设备后，外部设备才能通过已映射的外部端口回复数据包。
- **优点**：
    
    - 比完全圆锥型 NAT 更安全。
- **缺点**：
    
    - 外部设备不能主动发起连接，可能对某些应用程序造成限制。

---

### 3. **端口受限圆锥型 NAT（Port Restricted Cone NAT）**

- **特性**：
    
    - 在受限圆锥型 NAT 的基础上进一步限制：
        - 外部设备只有在特定端口上收到内部设备的连接请求后，才能通过该端口回复数据包。
- **优点**：
    
    - 比受限圆锥型 NAT 更加安全。
- **缺点**：
    
    - 连接建立较为复杂，对某些应用程序的兼容性较差。

---

### 4. **对称型 NAT（Symmetric NAT）**

- **特性**：
    
    - 一个内部地址和端口的映射取决于目标外部地址和端口。
    - 每次连接到不同的外部目标都会生成不同的映射。
    - 外部设备无法直接发起连接，即使内部设备先发送了数据包。
- **优点**：
    
    - 安全性最高。
- **缺点**：
    
    - 对P2P和VoIP应用支持最差，因为很难穿透NAT。

---

### **对比总结**

| 类型          | 安全性 | 穿透难度 | 特点            |
| ----------- | --- | ---- | ------------- |
| 完全圆锥型 NAT   | 低   | 最低   | 所有人可访问映射的端口   |
| 受限圆锥型 NAT   | 中   | 中低   | 外部设备需先接收到内部请求 |
| 端口受限圆锥型 NAT | 高   | 中高   | 需要特定端口匹配      |
| 对称型 NAT     | 最高  | 最高   | 每次连接生成唯一映射    |
对称型 NAT > 端口受限圆锥型 NAT > 受限圆锥型 NAT > 完全圆锥型 NAT
### **应用建议**

- **完全圆锥型 NAT**：适合无严格安全需求的环境，如家庭娱乐网络。
- **受限圆锥型 NAT 和端口受限圆锥型 NAT**：适合需要一定安全性但仍需较高连接性能的环境。
- **对称型 NAT**：适合高安全需求的企业网络。